import {
  CodeSurfer,
} from "code-surfer";
import { vsDark } from "@code-surfer/themes";

export const theme = vsDark;

## Абстрактные транзакции в Go

Презентация исходного кода

---

<CodeSurfer>

```jsx file=./src/base/app_structure.txt title="Структура проекта"
```

```jsx 16:17 file=./src/base/app_structure.txt title="Структура проекта" subtitle="Модели предметной области"
```

```jsx file=./src/base/app_structure.txt title="Структура проекта"
```

```jsx 12:13 file=./src/base/app_structure.txt title="Структура проекта" subtitle="Исполнитель команд"
```

```jsx file=./src/base/app_structure.txt title="Структура проекта"
```

```jsx 18:20 file=./src/base/app_structure.txt title="Структура проекта" subtitle="Реализация репозитория"
```

```jsx file=./src/base/app_structure.txt title="Структура проекта"
```

```jsx 14:15 file=./src/base/app_structure.txt title="Структура проекта" subtitle="Командный интерфейс"
```

```jsx file=./src/base/app_structure.txt title="Структура проекта"
```

```jsx 2:6 file=./src/base/app_structure.txt title="Структура проекта" subtitle="Точки входа"
```

```jsx file=./src/base/app_structure.txt title="Структура проекта"
```

</CodeSurfer>

---

<CodeSurfer>

```jsx file=./src/base/clean_architecture.txt title="Слои сервиса"
```

</CodeSurfer>

---

<CodeSurfer>

```jsx file=./src/base/app_structure.txt title="Слой предметной области"
```

```jsx 17 file=./src/base/app_structure.txt title="Слой предметной области"
```

</CodeSurfer>

---

<CodeSurfer>

```jsx 1:12 file=./src/base/domain/doctor.go title="Слой предметной области" subtitle="Модели ошибок"
```

```jsx 13:32 file=./src/base/domain/doctor.go title="Слой предметной области" subtitle="Модель доктора"
```

```jsx 33:50 file=./src/base/domain/doctor.go title="Слой предметной области" subtitle="Модели коллекций докторов"
```

</CodeSurfer>

---

<CodeSurfer>

```jsx file=./src/base/app_structure.txt title="Слой приложения"
```

```jsx 13 file=./src/base/app_structure.txt title="Слой приложения"
```

</CodeSurfer>

---

<CodeSurfer>

```jsx 1:18 file=./src/base/app/command_executor.go title="Слой приложения" subtitle="Исполнитель команд"
```

```jsx 19:33 file=./src/base/app/command_executor.go title="Слой приложения" subtitle="Команда 'Начать смену'"
```

```jsx 34:54 file=./src/base/app/command_executor.go title="Слой приложения" subtitle="Команда 'Закончить смену'"
```

</CodeSurfer>

---

<CodeSurfer>

```jsx file=./src/base/app_structure.txt title="Инфраструктура: адаптер postgresql"
```

```jsx 20 file=./src/base/app_structure.txt title="Инфраструктура: адаптер postgresql"
```

</CodeSurfer>

---

<CodeSurfer>

```jsx 1:21 file=./src/base/pgsql/doctor_repository.go title="Инфраструктура: адаптер postgresql" subtitle="Реализация репозитория"
```

```jsx 22:37 file=./src/base/pgsql/doctor_repository.go title="Инфраструктура: адаптер postgresql" subtitle="Извлечение модели доктора"
```

```jsx 38:50 file=./src/base/pgsql/doctor_repository.go title="Инфраструктура: адаптер postgresql" subtitle="Обновление модели доктора"
```

```jsx 51:77 file=./src/base/pgsql/doctor_repository.go title="Инфраструктура: адаптер postgresql" subtitle="Извлечение дежурных докторов"
```

</CodeSurfer>

---

### Внедрение транзакции

---

<CodeSurfer>

```jsx file=./src/base/app_structure.txt title="Внедрение транзакции"
```

```jsx 13 file=./src/base/app_structure.txt title="Внедрение транзакции"
```

</CodeSurfer>

---

<CodeSurfer>

```jsx 34:54 file=./src/base/app/command_executor.go title="Внедрение транзакции" subtitle="Потерянное обновление"
```

```jsx 35:38 file=./src/base/app/command_executor.go title="Внедрение транзакции" subtitle="Два конкурентных запроса считали, что 1 доктор дежурит"
```

```jsx 49:51 file=./src/base/app/command_executor.go title="Внедрение транзакции" subtitle="Два конкурентных запроса завершили смены двух докторов"
```

</CodeSurfer>

---

<CodeSurfer>

```jsx file=./src/base/app_structure.txt title="Внедрение транзакции"
```

```jsx 20 file=./src/base/app_structure.txt title="Внедрение транзакции"
```

</CodeSurfer>

---

<CodeSurfer>

```jsx 51:77 file=./src/base/pgsql/doctor_repository.go title="Внедрение транзакции" subtitle="Извлечение дежурных докторов"
```

```jsx 56 file=./src/base/pgsql/doctor_repository.go title="Внедрение транзакции" subtitle="Извлечение дежурных докторов"
```

```jsx 56 file=./src/for_update/doctor_repository.go title="Внедрение транзакции" subtitle="Извлечение дежурных докторов: блокировка строк"
```

</CodeSurfer>

---

### №1 Транзакция в репозитории

---

### №2 Транзакция в context.Context

---

### №3 Единица работы

---

### №4 Единица работы в callback-функции

---

### №5 Сквозная транзакция

---
Спасибо за внимание!
